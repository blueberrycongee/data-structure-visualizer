好的，这是对课程最后一部分内容的完整总结，涵盖了所有提到的知识点。

### **第四部分：数据链路层 (续) - 选择重传协议 (SR)**

1.  **协议六：选择重传协议 (Selective Repeat, SR)**
    *   **设计目标**：克服回退N帧协议（GBN）的低效率问题，实现**只重传出错或丢失的帧**。
    *   **核心特点**：
        *   **发送窗口大小 (W_S) > 1**。
        *   **接收窗口大小 (W_R) > 1**。
    *   **工作流程**：
        *   **发送方**：可以连续发送窗口内的所有帧，并为**每一个已发送的帧**都设置一个独立的计时器。
        *   **接收方**：
            *   可以接收并**缓存**任何落在其接收窗口内的帧，即使它们是**乱序**的。
            *   当收到一个正确的帧后，会发送对**该特定帧**的确认（**选择性确认**）。
            *   只有当从窗口下界开始的连续多个帧都已收到后，才会将这些帧**按序**交付给网络层，并向前滑动窗口。
        *   **差错处理**：
            *   当发送方某个帧的计时器超时，它**只重传那一个帧**。
            *   接收方可以通过发送**否定确认 (NAK - Negative Acknowledgement)** 来主动告知发送方某个帧没有收到，从而触发发送方的**快速重传**，而无需等待超时。

2.  **SR协议的窗口大小限制 (核心考点)**
    *   **问题**：为了避免新旧窗口序号重叠导致无法区分是重传帧还是新帧的问题。
    *   **结论**：发送窗口大小（W_S）和接收窗口大小（W_R）之和必须**小于或等于**序号空间的大小。
        *   **公式**：`W_S + W_R ≤ 2^n`
    *   **特例**：在通常情况下（也是代码和多数题目默认的情况），发送窗口和接收窗口大小相等 (`W_S = W_R = W`)。此时，不等式变为 `2 * W ≤ 2^n`，即 `W ≤ 2^(n-1)`。
    *   **原因详解**：讲师通过一个例子说明，如果`W_S + W_R > 2^n`，当发生确认帧全部丢失的情况时，发送方超时重传一个旧序号的帧（如0号帧），而接收方的窗口此时可能已经滑动到了包含新一轮0号帧的位置。接收方会错误地将这个重传的旧帧当作新帧接收，导致协议出错。

3.  **SR协议与NAK机制的结合**
    *   **快速重传**：当接收方收到乱序帧时（如收到了3号、4号，但没收到2号），它可以立即发送`NAK 2`，通知发送方“我没收到2号帧”。发送方收到`NAK`后，可以立即重传2号帧，而不必等待2号帧的计时器超时。
    *   **确认机制的变化**：讲师指出，当SR协议引入NAK机制后，其`ACK`通常会采用**累计确认**的方式，而`NAK`则用于**选择性地**指出丢失的帧。这结合了两种确认方式的优点。

### **第五部分：信道利用率与序号位数的计算 (核心考点)**

讲师总结了计算滑动窗口协议性能的两个关键公式，并强调这是数据链路层最重要的计算题型。

1.  **信道利用率 (U)**
    *   **公式**：`U = T_f / (T_s + RTT + T_a)`
    *   **参数**：
        *   `T_f`：发送方**在一个发送周期内连续发送所有窗口帧**所花费的总时间。`T_f = W_S * T_s`。
        *   `T_s`：发送**一个数据帧**所需的时间（发送时延）。`T_s = 帧长度(bit) / 信道带宽(bps)`。
        *   `RTT`：往返传播时延。`RTT = 2 * 单向传播时延`。
        *   `T_a`：发送**一个确认帧**所需的时间。如果确认帧很短，题目可能会说明“忽略不计”（即`T_a = 0`）；如果是捎带确认，则`T_a = T_s`。
    *   **逻辑**：利用率 = `(真正用于发送数据的时间) / (从发送第一个比特到收到最后一个确认比特的总周期时间)`。

2.  **最大数据传输速率 (Throughput)**
    *   **计算方式**：`Throughput = 信道利用率 * 信道带宽`。
    *   **另一种公式**：`Throughput = (W_S * 帧长度) / (T_s + RTT + T_a)`，然后与信道带宽比较，取较小值。

3.  **最小帧序号比特数 (n) 的计算**
    *   **步骤**：
        1.  根据题目给定的目标信道利用率（如不小于80%），利用信道利用率公式反求出所需的最小发送窗口大小 `W_S`。
        2.  **注意**：计算出的`W_S`可能是小数（如7.2），需要**向上取整**（如8），因为窗口大小必须是整数。
        3.  根据所使用的协议（GBN或SR），代入相应的窗口大小限制公式，求解最小的比特数`n`。
            *   **GBN**：`W_S ≤ 2^n - 1`
            *   **SR (W_S=W_R)**：`W_S ≤ 2^(n-1)`
        4.  **重要**：如果题目只说是“滑动窗口协议”而未明确是GBN还是SR，**严谨的做法是两种情况都要考虑**，并选择能满足两种情况的最小`n`值。

### **第六部分：其他协议与课程收尾**

*   **点对点协议 (PPP - Point-to-Point Protocol)**：讲师表示此协议非考试重点，在PPT中也标记为“了解”，因此课程中不详细讲解。他已将相关要点放入补充材料中，供感兴趣的同学自学。
*   **课程互动与总结**：讲师与学生互动，解答了关于协议细节（如窗口回退、极端网络故障）和两军问题（理论上无法100%达成共识）的疑问，并强调了复习应抓住重点，不必在非核心或过于理论化的问题上深究。
*   **作业布置**：布置了数据链路层相关的作业题和补充习题，涵盖了汉明码、CRC、信道利用率计算等多个知识点，并预告下次课将进行讲解。