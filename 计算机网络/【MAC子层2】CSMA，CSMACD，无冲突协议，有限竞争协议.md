好的，这是对课程最后一部分内容的完整总结，涵盖了所有提到的知识点。

### **第一部分：MAC子层协议 (续)**

1.  **载波侦听多路访问 (CSMA)**
    *   **核心思想**：在ALOHA的基础上增加了**载波侦听 (Carrier Sense)** 的功能，即**先听后发 (Listen Before Talk)**。
    *   **冲突检测方式**：与CSMA/CD不同，CSMA协议**不能实时检测冲突**。它通常是通过上层机制（如未收到ACK确认帧）来**事后推断**发生了冲突。
    *   **三种坚持策略 (Persistence Strategies)**：
        *   **1-坚持CSMA (1-persistent CSMA)**：
            *   **信道空闲**：立即发送。
            *   **信道忙碌**：**持续侦听**，一旦空闲立即发送。
            *   **优缺点**：减少了信道空闲时间，但当多个节点同时等待时，一旦信道变空闲，它们会同时发送，导致冲突概率增大。
        *   **非坚持CSMA (Non-persistent CSMA)**：
            *   **信道空闲**：立即发送。
            *   **信道忙碌**：**不持续侦听**，而是等待一个**随机**时间后，再回来重新侦听。
            *   **优缺点**：降低了冲突概率，但可能在信道已空闲而节点仍在等待的随机时间内造成带宽浪费。
        *   **p-坚持CSMA (p-persistent CSMA)**：
            *   **应用场景**：用于**分槽信道 (Slotted Channel)**。
            *   **信道空闲**：以概率`p`发送，以概率`1-p`延迟到下一个时隙再做决定。
            *   **信道忙碌**：**持续侦听**，等待下一个时隙再重新开始决策过程。
            *   **辨析**：讲师指出，“1-坚持CSMA是p-坚持CSMA在p=1时的特例”这种说法不完全准确，因为1-坚持CSMA不要求分槽信道。

2.  **带冲突检测的CSMA (CSMA/CD)**
    *   **核心思想**：在CSMA的基础上增加了**冲突检测 (Collision Detection)** 功能，即**边发边听 (Listen While Talk)**。
    *   **工作流程**：
        1.  **先听后发**：发送前侦听信道。
        2.  **边发边听**：发送数据的同时，持续侦听信道，检查信号是否与发送的信号一致。
        3.  **冲突处理**：如果检测到冲突（信号不一致），立即**停止发送**数据，并发送一个简短的**冲突加强信号 (Jam Signal)**，以确保所有节点都知道发生了冲突。
        4.  **随机退避**：等待一个随机时间后，返回第1步重新尝试。
    *   **冲突窗口期 (Contention Window)**：一个节点能够检测到冲突的最长时间，等于信号在网络中传播一个**往返时延 (RTT)**。
    *   **最小帧长 (Minimum Frame Length)**：
        *   **原因**：为了确保发送方在发送完一帧之前，能够检测到可能发生的最远端的冲突。帧的发送时间必须**不小于**冲突窗口期(RTT)。
        *   **计算**：对于经典的10Mbps以太网，RTT约为50μs，可以传输500bit。加上安全余量，规定最小帧长为512bit，即**64字节**。
        *   **意义**：任何小于64字节的帧都被认为是由于冲突而异常中止的**无效帧 (Runt Frame)**。
    *   **二进制指数退避算法 (Binary Exponential Backoff)**：
        *   **目的**：在发生冲突后，动态地调整随机等待时间的范围，以适应网络负载。
        *   **算法**：
            1.  在第`k`次连续碰撞后，从`[0, 1, ..., 2^k - 1]`的集合中随机选择一个整数`r`。
            2.  等待`r`个**时隙 (Slot Time)** 的时间后再尝试发送。（一个时隙时间等于RTT）。
            3.  `k`的最大值被限制在10。即在第10次及以后的碰撞中，`k`始终取10，随机范围为`[0, 1023]`。
            4.  如果连续碰撞达到**16次**，则放弃发送，并向高层报告错误。

### **第二部分：无冲突协议 (受控访问)**

讲师强调，这部分内容在近十年考试中未出现过，属于非重点。

1.  **位图协议 (Bitmap Protocol)**
    *   **原理**：在数据传输前，有一个**竞争期 (Contention Period)**。竞争期包含`N`个时隙（`N`为节点数）。想发送数据的节点在自己对应的时隙中发送一个比特`1`。竞争期结束后，所有节点都知道了哪些节点想发送数据，然后按照节点序号**轮流发送**数据帧。

2.  **令牌环协议 (Token Ring)**
    *   **原理**：一个称为**令牌 (Token)** 的短消息在一个**逻辑环**中按预定顺序传递。只有持有令牌的节点才有权发送数据。发送完数据（或无数据可发）后，将令牌传递给下一个节点。

3.  **二进制倒计数协议 (Binary Countdown)**
    *   **原理**：想发送数据的节点同时以二进制形式**广播自己的地址**，从高位开始。信道执行**逻辑或 (OR)** 操作。如果一个节点发送的是`0`但监听到信道上是`1`，意味着有更高地址的节点在竞争，该节点便**退出竞争**。最终，地址最高的节点将赢得信道使用权。
    *   **优点**：非常高效，尤其是在精心设计下，地址广播过程本身就可以作为数据帧的第一个字段，实现100%的信道利用率。

4.  **有限竞争协议 - 自适应树遍历协议 (Adaptive Tree Walk Protocol)**
    *   **原理**：将所有节点组织成一棵二叉树。当发生冲突时，只允许树的一部分节点（如左子树的节点）进行竞争。如果仍然冲突，则继续将竞争范围缩小（如左子树的左子树），直到没有冲突为止。这类似于**二分查找**的思想。

### **第三部分：以太网 (Ethernet)**

1.  **以太网发展**
    *   **经典以太网**：使用总线型拓扑，共享介质，采用CSMA/CD协议，速率为3-10Mbps。现已过时。
    *   **交换式以太网**：现代以太网的主流，使用**交换机 (Switch)** 连接节点，形成星型拓扑。每个端口独享带宽，通常工作在**全双工 (Full-Duplex)** 模式下，**不再需要CSMA/CD协议**。
    *   **速率演进**：快速以太网(100Mbps) -> 千兆以太网(1Gbps) -> 万兆以太网(10Gbps)及更高。

2.  **以太网帧格式 (两种标准)**
    *   **DIX v2 (施乐标准)** 和 **IEEE 802.3**：两者在帧结构上略有不同，但可以兼容。
    *   **兼容机制**：通过一个特定的字段来区分。
        *   如果该字段值**大于`0x0600`**，则被解释为**类型 (Type)** 字段（DIX v2标准），指明上层协议（如IP、ARP）。
        *   如果该字段值**小于等于`0x0600`**，则被解释为**长度 (Length)** 字段（IEEE 802.3标准），指明数据部分的长度。
    *   **帧长度确定**：
        *   **IEEE 802.3**：通过**长度字段**。
        *   **DIX v2**：没有长度字段。接收方通过检测信道上信号的**间歇 (Inter-packet Gap)** 来判断一帧的结束。
    *   **最大帧长**：数据部分最大为**1500字节**。这个限制源于早期网络设备内存昂贵的历史原因。
    *   **MAC地址**：6字节（48位）的全球唯一硬件地址，用于在局域网内标识设备。

### **课程收尾**

*   **作业布置**：布置了MAC子层相关的作业题，包括ALOHA、位图协议、二进制指数退避算法等，并预告下次课讲解。
*   **下次课程内容**：将继续讲解MAC子层的剩余部分，并进入下一章节。